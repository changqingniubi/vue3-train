{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/reactive.ts"],"sourcesContent":["/*\n * @Description: \n * @Author: changqing\n * @Date: 2021-12-15 17:55:45\n * @LastEditTime: 2021-12-17 14:31:35\n * @LastEditors: changqing\n * @Usage: \n */\nexport function isObject(value: unknown): boolean {\n  return typeof value === 'object' && value !== null\n}\nexport function isFunction(value):boolean{\n  return typeof value === 'function'\n}","/*\n * @Description: \n * @Author: changqing\n * @Date: 2021-12-17 11:07:14\n * @LastEditTime: 2021-12-17 14:26:20\n * @LastEditors: changqing\n * @Usage: \n */\nimport { isObject } from \"@vue/shared\";\n\nconst enum ReactiveFlags{\n  IS_REACTIVE = '__v_isReactive'\n}\n\nconst mutableHandlers: ProxyHandler<Record<any, any>> = {\n  get(target, key, recevier) { // 代理对象的本身\n      if (key === ReactiveFlags.IS_REACTIVE) {\n          return true;\n      }\n      // 这里取值了， 可以收集他在哪个effect中\n      const res = Reflect.get(target, key, recevier); // target[key]\n      return res;\n  },\n  set(target, key, value, recevier) {\n\n      // 如果改变值了， 可以在这里触发effect更新\n      const res = Reflect.set(target, key, value, recevier); // target[key] = value\n      return res;\n  }\n}\n// map和weakMap的区别\nconst reactiveMap = new WeakMap(); // weakmap 弱引用   key必须是对象，如果key没有被引用可以被自动销毁\n\nfunction createReactiveObject(target: object) { \n  // 先默认认为这个target已经是代理过的属性了\n  if ((target as any)[ReactiveFlags.IS_REACTIVE]) {\n      return target\n  }\n  // reactiveApi 只针对对象才可以 \n  if (!isObject(target)) {\n      return target\n  }\n  const exisitingProxy = reactiveMap.get(target); // 如果缓存中有 直接使用上次代理的结果\n  if (exisitingProxy) {\n      return exisitingProxy\n  }\n  const proxy = new Proxy(target, mutableHandlers); // 当用户获取属性 或者更改属性的时候 我能劫持到\n  reactiveMap.set(target, proxy); // 将原对象和生成的代理对象 做一个映射表\n\n  return proxy; // 返回代理\n}\n\nexport function reactive(target: object) {\n  return createReactiveObject(target)\n}\n\n// readonly shallowReactive shallowReadnly \n// export function readonly(){\n// }\n// export function shallowReactive(){\n// }\n// export function shallowReadnly(){\n// }\n"],"names":[],"mappings":";;;EAAA;;;;;;;;WAQgB,QAAQ,CAAC,KAAc;MACrC,OAAO,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,IAAI,CAAA;EACpD;;ECVA;;;;;;;;EAcA,MAAM,eAAe,GAAmC;MACtD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;UACrB,IAAI,GAAG,yCAAgC;cACnC,OAAO,IAAI,CAAC;WACf;;UAED,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;UAC/C,OAAO,GAAG,CAAC;OACd;MACD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;;UAG5B,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;UACtD,OAAO,GAAG,CAAC;OACd;GACF,CAAA;EACD;EACA,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;EAElC,SAAS,oBAAoB,CAAC,MAAc;;MAE1C,IAAK,MAAc,oCAA2B,EAAE;UAC5C,OAAO,MAAM,CAAA;OAChB;;MAED,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;UACnB,OAAO,MAAM,CAAA;OAChB;MACD,MAAM,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;MAC/C,IAAI,cAAc,EAAE;UAChB,OAAO,cAAc,CAAA;OACxB;MACD,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;MACjD,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;MAE/B,OAAO,KAAK,CAAC;EACf,CAAC;WAEe,QAAQ,CAAC,MAAc;MACrC,OAAO,oBAAoB,CAAC,MAAM,CAAC,CAAA;EACrC,CAAC;EAED;EACA;EACA;EACA;EACA;EACA;EACA;;;;;;;;;;;;;"}